# Logrotate configuration for RDS MCP Server logs
# 用于轮转Gunicorn访问日志和错误日志

/app/logs/access.log {
    daily
    rotate 30
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 664 root root
    postrotate
        # 向Gunicorn主进程发送USR1信号重新打开日志文件
        if [ -f /tmp/gunicorn.pid ]; then
            kill -USR1 $(cat /tmp/gunicorn.pid) 2>/dev/null || true
        fi
    endscript
}

/app/logs/error.log {
    daily
    rotate 30
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 664 root root
    postrotate
        # 向Gunicorn主进程发送USR1信号重新打开日志文件
        if [ -f /tmp/gunicorn.pid ]; then
            kill -USR1 $(cat /tmp/gunicorn.pid) 2>/dev/null || true
        fi
    endscript
}

# 应用日志由Python RotatingFileHandler处理，不需要logrotate
# /app/logs/app.log 已通过 RotatingFileHandler 自动轮转